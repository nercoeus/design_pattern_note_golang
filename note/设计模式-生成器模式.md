---
title: è®¾è®¡æ¨¡å¼-ç”Ÿæˆå™¨æ¨¡å¼
date: 2019-10-31 20:24:59
categories: è®¾è®¡æ¨¡å¼ã€‘
---

# 1 ç”Ÿæˆå™¨æ¨¡å¼ï¼ˆBuilder patternï¼‰
**ç”Ÿæˆå™¨æ¨¡å¼å®šä¹‰**ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºå’Œå®ƒçš„è¡¨ç¤ºè¿›è¡Œåˆ†ç¦»ï¼Œè®©ä½ å¯ä»¥ä¸€æ­¥æ­¥çš„åˆ›å»ºå¯¹è±¡ã€‚å¹¶ä¸”å¯ä»¥ç”¨ç›¸åŒçš„æ„å»ºè¿‡ç¨‹æ¥åˆ›å»ºä¸åŒçš„è¡¨ç¤º  
# 2 ç›®æ ‡é—®é¢˜
![](../img/è®¾è®¡æ¨¡å¼-ç”Ÿæˆå™¨æ¨¡å¼/1.png)
&emsp;&emsp;å½“ä½ è¦åˆ›å»ºä¸€ä¸ªå¤æ‚å¯¹è±¡ï¼Œæœ‰å¤šä¸ªå°éƒ¨åˆ†ç¥–æˆã€‚ä¾‹å¦‚æˆ¿å­=å››é¢å¢™+é—¨+çª—å­+æˆ¿é¡¶ã€‚ä¸€ä¸ªæˆ¿å­ä¹Ÿå¯ä»¥åŒ…å«ä¸€äº›é¢å¤–çš„éƒ¨ä»¶ï¼Œä¾‹å¦‚ï¼šè½¦åº“ï¼Œæ¸¸æ³³æ± ï¼ŒèŠ±å›­ç­‰ç­‰ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæˆ¿å­ï¼Œä»£ç çš„åˆå§‹åŒ–éƒ¨åˆ†ä¼šå˜å¾—è¿‡äºè‡ƒè‚¿ï¼Œéœ€è¦å¤šæ‰€æœ‰é¢å¤–éƒ¨ä»¶è¿›è¡Œè®¾ç½®ã€‚å¯èƒ½éœ€è¦æ¸¸æ³³æ± ä¸éœ€è¦èŠ±å›­ï¼Œä¹Ÿå¯èƒ½éœ€è¦è½¦åº“ä¸éœ€è¦æ³³æ± ï¼Œä¹Ÿå¯èƒ½å…¨éƒ¨éƒ½éœ€è¦ã€‚è™½ç„¶å¤§å¤šæ•°æƒ…å†µæ³³æ± ï¼ŒèŠ±å›­éƒ½æ˜¯ä¸å¿…è¦çš„ã€‚  
&emsp;&emsp;è™½ç„¶ä¸€ä¸ªå·¨å¤§çš„æ„é€ å‡½æ•°æ¶ˆé™¤äº†å¯¹å­ç±»çš„éœ€æ±‚ï¼Œä½†æ˜¯å®ƒå®åœ¨æ˜¯å¤ªè¿‡äºä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ Builder pattern è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

# 3 è§£å†³æ–¹æ³•
&emsp;&emsp;æ–°å»ºä¸€ä¸ªç±»ç”¨æ¥å»ºé€ æˆ¿å­ï¼Œå³ç±»ä¼¼äºæ–½å·¥é˜Ÿï¼ˆGoFï¼šConcreteBuilderï¼‰çš„ä½œç”¨ï¼Œå°†åŸæ¥å¯¹è±¡ä¸­ç”¨æ¥æ„å»ºçš„ä»£ç ç§»åŠ¨åˆ°è¯¥å¯¹è±¡ä¸­è¿›è¡Œç®¡ç†ã€‚å¦‚æœè¦åˆ›å»ºå¯¹è±¡çš„æŸä¸€éƒ¨åˆ†ï¼Œç›´æ¥åœ¨è¯¥ç®¡ç†å¯¹è±¡ä¸­è¿›è¡Œè°ƒç”¨å³å¯ã€‚è¿™æ ·åšä¹Ÿå¯ä»¥è®©ä½ æ„å»ºä¸åŒè¡¨ç¤ºçš„å¯¹è±¡ï¼ˆegï¼šçŸ³å¤´æˆ¿å­æˆ–æ˜¯æœ¨å¤´æˆ¿å­ï¼‰ï¼ŒçŸ³å¤´æˆ¿å­ç”¨çŸ³å¤´æ–½å·¥é˜Ÿï¼Œæœ¨å¤´æˆ¿å­ç”¨æœ¨å¤´æ–½å·¥é˜Ÿå³å¯ã€‚è™½ç„¶ä»–ä»¬å»ºé€ çš„å¯¹è±¡ç›¸åŒï¼Œä½†æ˜¯è¡¨ç¤ºæ–¹å¼å®Œå…¨ä¸åŒï¼Œå³è™½ç„¶éƒ½æ˜¯æˆ¿å­ï¼Œä½†æ˜¯ç¡®å®ä¸åŒæè´¨çš„æˆ¿å­ã€‚  
&emsp;&emsp;ä¸ºäº†å®ç°ä¸€æ¡æµæ°´çº¿çš„æ“ä½œï¼Œä½ è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ªç›‘ç£è€…ï¼ˆGoFï¼šDirectorï¼‰ç”¨æ¥ä½¿ç”¨ ConcreteBuilder å®Œæˆä¸€ç³»åˆ—æ“ä½œï¼Œå¹¶å°†ç»“æœè¿”å›ç»™ä½ ã€‚è™½ç„¶æ²¡æœ‰ç›‘ç£è€…å®¢æˆ·ä¹Ÿå¯ä»¥è‡ªå·±è¿›è¡Œç›‘ç£ï¼Œå³æ‰§è¡Œä¸€äº›åˆ—çš„ build_XXX_Part å‡½æ•°ï¼Œä½†æ˜¯åˆ›å»ºä¸€ä¸ªç›‘ç£è€…å¯ä»¥ä¾›ä»£ç å¤ç”¨ï¼Œå¹¶å°†å®¢æˆ·å’Œ builder åˆ†ç¦»å¼€æ¥ã€‚ä¹Ÿæ˜¯ä¸ªä¸é”™çš„æ–¹å¼  

# 4 æ‰€æœ‰ç±»ä¹‹é—´çš„å…³ç³»
![](../img/è®¾è®¡æ¨¡å¼-ç”Ÿæˆå™¨æ¨¡å¼/2.png)
- Builder æ¥å£
  - ä¸ºåˆ›é€ ä¸€ä¸ªå¯¹è±¡ï¼ˆProductï¼‰è€Œè®¾è®¡çš„ä¸€ç³»åˆ—æ–¹æ³•çš„æ¥å£
- ConcreteBuilder ç±»ï¼š
  - å®ç° Builder çš„æ¥å£æ¥æ„é€  Product çš„å„ä¸ªéƒ¨åˆ†
  - å®šä¹‰å¹¶è·Ÿè¸ªå®ƒæ‰€é•¿åˆ›å»ºçš„è¡¨ç¤º
  - æä¾›ä¸€ä¸ªæ£€ç´¢äº§å“çš„æ¥å£ï¼ˆGetProductï¼‰
- Director ç±»ï¼š
  - æ„é€ ä¸€ä¸ªä½¿ç”¨ builder æ¥å£çš„å¯¹è±¡
- Product ç±»ï¼š
  - è¡¨ç¤ºè¢«æ„é€ çš„å¤æ‚å¯¹è±¡ã€‚ConcreteBuilder åˆ›å»ºè¯¥ Product çš„å†…éƒ¨è¡¨ç¤ºå¹¶å®šä¹‰å…¶ builde è¿‡ç¨‹

# 5 ä»£ç å®ç°
&emsp;&emsp;æ¥ä¸‹æ¥ä½¿ç”¨ GO ä»£ç æ¥è¿›è¡Œ Builder pattern çš„å®ç°
```go
type HouseBuilder interface {
	buildHouse()
	buildSwimmingPool()
	buildGarden()
	buildGarage()
}
// æœ¨å¤´æˆ¿æ–½å·¥é˜Ÿ
type WoodHouseBuilder struct{
	House
}
// æœ¨å¤´æˆ¿å­æ–½å·¥æµç¨‹
func (wb *WoodHouseBuilder)buildHouse(){
	wb.Wall = "Wood Wall"
	wb.Door = "Wood Door"
	wb.Roof = "Wood Roof"
}
func (wb *WoodHouseBuilder) buildSwimmingPool(){
	wb.SwimmingPool = "Wood SwimmingPool"
}
func (wb *WoodHouseBuilder) buildGarden(){
	wb.Garden = "Wood Garden"
}
func (wb *WoodHouseBuilder) buildGarage(){
	wb.Garage = "Wood Garage"
}
// çŸ³å¤´æˆ¿æ–½å·¥é˜Ÿ
type StoneHouseBuilder struct{
	House
}
// çŸ³å¤´æˆ¿å­çš„æ–½å·¥æµç¨‹
func (sb *StoneHouseBuilder)buildHouse(){
	sb.Wall = "Stone Wall"
	sb.Door = "Stone Door"
	sb.Roof = "Stone Roof"
}
func (sb *StoneHouseBuilder) buildSwimmingPool(){
	sb.SwimmingPool = "Stone SwimmingPool"
}
func (sb *StoneHouseBuilder) buildGarden(){
	sb.Garden = "Stone Garden"
}
func (sb *StoneHouseBuilder) buildGarage(){
	sb.Garage = "Stone Garage"
}
```
&emsp;&emsp;å®é™…çš„ Builder,é€šè¿‡ä¸åŒçš„ Builder å¯ä»¥è·å–ç›¸åŒå¯¹è±¡çš„ä¸åŒè¡¨ç¤º(eg:æœ¨å¤´æˆ¿å­å’ŒçŸ³å¤´æˆ¿å­)
```go
type House struct {
	Wall string
	Door string
	Roof string
	SwimmingPool string
	Garden string
	Garage string
}
```
&emsp;&emsp;ç”¨æˆ·æœ€åè·å¾—çš„ House å¯¹è±¡
```go
// ç›‘ç£è€…ç±»
type Director struct {
	houseBuilder HouseBuilder  // çœŸæ­£çš„ Builder
	class string
}
// æ„å»º House çš„åŸºæœ¬éƒ¨åˆ†
func (d *Director) makeHouse(){
	d.houseBuilder.buildSwimmingPool()
	d.houseBuilder.buildGarage()
	d.houseBuilder.buildGarden()
}
// è®¾ç½®éœ€è¦çš„ç±»å‹
func (d *Director) SetHouseBuilder(t string){
	switch t{
	case "Wood":
		d.houseBuilder = &WoodHouseBuilder{}
	case "Stone":
		d.houseBuilder = &StoneHouseBuilder{}
	}
	d.houseBuilder.buildHouse()
	d.class = t
}
// è·å–å»ºå¥½çš„æˆ¿å­
func (d *Director) GetHouse() *House{
	switch d.class{
	case "Wood":
		return &d.houseBuilder.(*WoodHouseBuilder).House
	case "Stone":
		return &d.houseBuilder.(*StoneHouseBuilder).House
	}
	return nil
}
```
&emsp;&emsp;ä¸Šé¢å±•ç¤ºäº†é€šè¿‡ Director æ¥æ§åˆ¶å¯¹è±¡çš„æ„å»ºæµç¨‹,å¯ä»¥å°†ä¸€ç³»åˆ—çš„æ„å»ºæ“ä½œå°è£…å¤ç”¨.
```go
func main() {
	director := Director{}
	director.SetHouseBuilder("Wood")
	director.makeHouse()
	house := director.GetHouse()
	fmt.Println("------------------------")
	fmt.Println(house.Wall)
	fmt.Println(house.Door)
	fmt.Println(house.Roof)
	fmt.Println(house.SwimmingPool)
	fmt.Println(house.Garage)
	fmt.Println(house.Garden)
	fmt.Println("------------------------")
	director.SetHouseBuilder("Stone")
	director.makeHouse()
	house = director.GetHouse()
	fmt.Println(house.Wall)
	fmt.Println(house.Door)
	fmt.Println(house.Roof)
	fmt.Println(house.SwimmingPool)
	fmt.Println(house.Garage)
	fmt.Println(house.Garden)
	fmt.Println("------------------------")
}
```
&emsp;&emsp;å®¢æˆ·æ‰§è¡Œé€»è¾‘å¦‚ä¸Š,æ–°å»ºä¸€ä¸ª Director å†é€šçŸ¥å®ƒä½ éœ€è¦ä»€ä¹ˆæ ·çš„æˆ¿å­,ä¹‹åäº¤ç»™å®ƒè¿›è¡Œæ„å»º,æœ€åç›´æ¥è·å–å³å¯.è¿è¡Œç»“æœå¦‚ä¸‹:
![](../img/è®¾è®¡æ¨¡å¼-ç”Ÿæˆå™¨æ¨¡å¼/3.png)

# 6 åº”ç”¨åœºæ™¯
ä»¥ä¸‹æƒ…å†µå¯ä»¥ä½¿ç”¨**ç”Ÿæˆå™¨æ¨¡å¼**ï¼š
- å½“åˆ›å»ºå¤æ‚å¯¹è±¡çš„ç®—æ³•åº”è¯¥ç‹¬ç«‹äºè¯¥å¯¹è±¡çš„ç»„æˆéƒ¨åˆ†ä»¥åŠå®ƒä»¬çš„è£…é…æ–¹å¼æ—¶ã€‚
- å½“æ„é€ è¿‡ç¨‹å¿…é¡»å…è®¸è¢«æ„é€ çš„å¯¹è±¡æœ‰ä¸åŒè€Œè¡¨ç¤ºæ—¶ã€‚
- ä½¿ç”¨ Builder æ¥æ„é€ å¤åˆå¯¹è±¡æˆ–å…¶ä»–çš„å¤æ‚å¯¹è±¡æ—¶ã€‚

# 7 ä¼˜ç¼ºç‚¹

## 7.1 ä¼˜ç‚¹
- å¯ä»¥é€æ­¥æ„é€ å¯¹è±¡ï¼Œæ¨è¿Ÿæ„é€ è¿‡ç¨‹æˆ–é€’å½’è¿è¡Œæ„é€ è¿‡ç¨‹ã€‚å³å¯¹æ„é€ è¿‡ç¨‹æä¾›æ›´åŠ ç²¾ç¡®çš„æ§åˆ¶
- å¯ä»¥æ”¹å˜ä¸€ä¸ª Product çš„å†…éƒ¨è¡¨ç¤ºï¼Œå³ä½¿ç”¨ç›¸åŒçš„æ„é€ ä»£ç è·å–ä¸åŒè¡¨ç¤ºçš„ Product
- å°†æ„é€ ä»£ç å’Œ Product çš„ä¸šåŠ¡é€»è¾‘ä»£ç è¿›è¡Œéš”ç¦»

## 7.2 ç¼ºç‚¹
- ä¼šè®©ä»£ç å˜å¾—å¤æ‚ï¼šå› ä¸ºå¢åŠ äº†è®¸å¤šæ¥å£ä»¥åŠæ–°çš„ç±»ï¼ˆè²Œä¼¼å¤§å¤šæ•°æ¨¡å¼éƒ½æœ‰è¿™ä¸ªğŸ˜“ã€‚ã€‚ã€‚ï¼‰

# 8 ç›¸å…³æ¨¡å¼

- å¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºå’Œ Factory ç³»åˆ—çš„æ¨¡å¼ç±»ä¼¼ï¼ŒåŒºåˆ«ä»…ä»…æ˜¯ï¼ŒBuilder æ³¨é‡æ„é€ å•ä¸ªå¯¹è±¡çš„è¿‡ç¨‹ï¼Œè€Œ Factory æ³¨é‡æ„é€ ä¸åŒç³»åˆ—çš„å¯¹è±¡ã€‚
- Builder ä¹Ÿå¯ä»¥å®ç°ä¸ºå•ä¾‹æ¨¡å¼ã€‚
- åˆ›å»ºå¤æ‚çš„ Composite é€šå¸¸ä½¿ç”¨ Builder è¿›è¡Œé€’å½’åˆ›å»ºã€‚

# 9 reference

1. ã€Šè®¾è®¡æ¨¡å¼ã€‹-ç”Ÿæˆå™¨æ¨¡å¼  
2. [design-patterns:Builder](https://refactoring.guru/design-patterns/builder)  
3. [ä¸­æ–‡ç»´åŸºï¼šç”Ÿæˆå™¨æ¨¡å¼](https://zh.wikipedia.org/wiki/%E7%94%9F%E6%88%90%E5%99%A8%E6%A8%A1%E5%BC%8F)  